{"version":3,"sources":["server/KurentoMonitor/KurentoHeartbeatMonitor.ts"],"names":["KurentoHeartbeatMonitor","KurentoHeartbeatMonitor.constructor","KurentoHeartbeatMonitor.start","KurentoHeartbeatMonitor.stop","KurentoHeartbeatMonitor.raiseEvent","KurentoHeartbeatMonitor.timerCallback","KurentoHeartbeatMonitor.successStatus","KurentoHeartbeatMonitor.getKurentoStatusFromDB","KurentoHeartbeatMonitor.getKurentoStatusFromMonit","KurentoHeartbeatMonitor.errorStatus"],"mappings":"AAEA,IAAO,aAAa,WAAW,iBAAiB,CAAC,CAAC;AAClD,IAAO,YAAY,WAAW,yBAAyB,CAAC,CAAC;AACzD,IAAO,cAAc,WAAW,kBAAkB,CAAC,CAAC;AACpD,IAAO,KAAK,WAAW,SAAS,CAAC,CAAC;AAKlC;IACCA,iCAAoBA,KAASA,EAClBA,OAAeA;QADNC,UAAKA,GAALA,KAAKA,CAAIA;QAClBA,YAAOA,GAAPA,OAAOA,CAAQA;QAEzBA,IAAIA,CAACA,QAAQA,GAAGA,IAAIA,cAAcA,EAAEA,CAACA;QACrCA,IAAIA,CAACA,EAAEA,GAAGA,IAAIA,YAAYA,EAAEA,CAACA;IAE9BA,CAACA;IAOMD,uCAAKA,GAAZA,UAAaA,GAAaA;QACzBE,IAAIA,CAACA,aAAaA,CAACA,IAAIA,CAACA,IAAIA,KAAKA,CAACA,GAAGA,CAACA,CAACA,CAACA;IACzCA,CAACA;IAEMF,sCAAIA,GAAXA,UAAYA,GAAaA;IACzBG,CAACA;IAGOH,4CAAUA,GAAlBA,UAAmBA,KAA0BA,EAAEA,MAAWA;QACzDI,EAAEA,CAAAA,CAACA,KAAKA,CAACA;YACRA,KAAKA,CAACA,MAAMA,CAACA,CAACA;IAChBA,CAACA;IAEOJ,+CAAaA,GAArBA;QACCK,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAACA,CAACA,EAACA,CAACA,GAACA,IAAIA,CAACA,aAAaA,CAACA,MAAMA,EAACA,CAACA,EAAEA,EAACA,CAACA;YAC7CA,IAAIA,CAACA,QAAQA,CAACA,cAAcA,CAACA,IAAIA,CAACA,aAAaA,CAACA,CAACA,CAACA,CAACA,GAAGA,CAACA,CAACA,IAAIA,CAAEA,IAAIA,CAACA,aAAaA,EAAEA,IAAIA,CAACA,WAAWA,CAACA,CAACA;QACrGA,CAACA;IACFA,CAACA;IAEOL,+CAAaA,GAArBA,UAAsBA,WAAwBA;QAC7CM,IAAIA,aAAaA,GAAkBA,IAAIA,aAAaA,CAACA,WAAWA,CAACA,CAACA;QAClEA,IAAIA,gBAAgBA,GAAkBA,IAAIA,CAACA,sBAAsBA,EAAEA,CAACA;QAGpEA,IAAIA,CAACA,UAAUA,CAACA,IAAIA,CAACA,QAAQA,EAAEA,aAAaA,CAACA,CAACA;IAC/CA,CAACA;IAION,wDAAsBA,GAA9BA;QAECO,MAAMA,CAACA,IAAIA,CAACA;IACbA,CAACA;IAEOP,2DAAyBA,GAAjCA;QAECQ,MAAMA,CAACA,IAAIA,CAACA;IACbA,CAACA;IAEOR,6CAAWA,GAAnBA,UAAoBA,KAAUA;IAG9BS,CAACA;IAUFT,8BAACA;AAADA,CAlEA,AAkECA,IAAA;AAED,iBAAS,uBAAuB,CAAC","file":"server/KurentoMonitor/KurentoHeartbeatMonitor.js","sourcesContent":["import logger = require('../Logger');\r\nimport MonitUrl = require('./MonitUrl');\r\nimport KurentoStatus = require('./KurentoStatus');\r\nimport KurentoHubDb = require('../Storage/KurentoHubDb');\r\nimport MonitApiClient = require('./MonitApiCLient');\r\nimport Monit = require('./Monit');\r\nimport MonitStatus = require('./MonitStatus');\r\nimport KurentoState = require('./KurentoState');\r\n\r\n\r\nclass KurentoHeartbeatMonitor{\r\n\tconstructor(private timer:any, \r\n\t\t\t\tprivate timeout: number){\r\n\t\t\t\t\t\r\n\t\tthis.monitApi = new MonitApiClient();\r\n\t\tthis.db = new KurentoHubDb();\r\n\r\n\t}\r\n\r\n\tpublic onstatus: (status:KurentoStatus) => void;\r\n\tpublic ononline: (status:KurentoStatus) => void;\r\n\tpublic onoffline: (status:KurentoStatus) => void;\r\n\tpublic onrestart: (status:KurentoStatus) => void;\r\n\t\r\n\tpublic start(url: MonitUrl): void {\r\n\t\tthis.startedMonits.push(new Monit(url));\t\t\r\n\t}\r\n\t\r\n\tpublic stop(url: MonitUrl): void {\t\r\n\t}\r\n\t\r\n\t\r\n\tprivate raiseEvent(event:(status:any) => void, status: any){\r\n\t\tif(event)\r\n\t\t\tevent(status);\r\n\t}\r\n\t\r\n\tprivate timerCallback(): void {\r\n\t\tfor (var i=0;i<this.startedMonits.length;i++){\r\n\t\t\tthis.monitApi.getMonitStatus(this.startedMonits[i].url).then( this.successStatus, this.errorStatus);\t\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate successStatus(monitStatus: MonitStatus): void{\r\n\t\tvar kurentoStatus: KurentoStatus = new KurentoStatus(monitStatus); \r\n\t\tvar oldKurentoStatus: KurentoStatus = this.getKurentoStatusFromDB();\r\n\t\t\r\n\t\t\r\n\t\tthis.raiseEvent(this.onstatus, kurentoStatus);\t\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\tprivate getKurentoStatusFromDB(): KurentoStatus{\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tprivate getKurentoStatusFromMonit(): KurentoStatus{\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tprivate errorStatus(error: any): void{\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate monitApi: MonitApiClient;\r\n\tprivate db: KurentoHubDb;\r\n\t\r\n\tprivate startedMonits: Monit[];\r\n\r\n\t\r\n\t\r\n\t\r\n}\r\n\r\nexport = KurentoHeartbeatMonitor;\r\n\r\n"],"sourceRoot":"../"}